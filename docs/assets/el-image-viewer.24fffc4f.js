import{a as D,d as Be}from"./index.9216fa11.js";import{ac as Me,R as Xe,p as Ie,g as f,K as ee,aN as He,l as ze,n as ae,E as ye,d as Ne,aO as Ce,Y as Te,as as De,j as g,aP as Fe,aQ as We,a5 as je,a7 as Oe,O as $e,o as E,q as be,w as p,b as d,am as Ke,a as I,t as m,e as s,V as Se,S as qe,x as z,c as R,F as ke,s as O,f as Ue,U as Re,v as Ze,aR as Ge,C as _e,a4 as Qe,a3 as Je,I as J,a0 as ea,aS as aa,y as Le,aT as sa,aU as we,aV as he,ar as ta,H as oa,aW as na}from"./index.4f85e2aa.js";import{g as la,E as ra,a as ia,b as ua}from"./focus-trap.6896987a.js";import{t as ca,h as da,b as fa,g as va,r as ma,E as V,_ as xe}from"./index.6ea50ac8.js";import{j as pa,s as ga,g as wa,e as ha,f as ya,z as ba,k as ka,r as Ia,n as Ea}from"./index.6801678b.js";import{m as Pe}from"./typescript.35cbd032.js";import{g as Ca,E as G}from"./event.4c24acf5.js";import{d as Sa}from"./debounce.f34ad4b7.js";import{u as La}from"./el-input.44c37742.js";var za="Expected a function";function ie(i,_,y){var u=!0,c=!0;if(typeof i!="function")throw new TypeError(za);return Me(y)&&(u="leading"in y?!!y.leading:u,c="trailing"in y?!!y.trailing:c),Sa(i,_,{leading:u,maxWait:_,trailing:c})}const Na=(i,_={})=>{Xe(i)||ca("[useLockscreen]","You need to pass a ref param to this function");const y=_.ns||Ie("popup"),u=f(()=>y.bm("parent","hidden"));let c=0,n=!1,v="0";const x=()=>{setTimeout(()=>{typeof document!="undefined"&&n&&document&&(document.body.style.width=v,ma(document.body,u.value))},200)};ee(i,F=>{if(!F){x();return}n=!da(document.body,u.value),n&&(v=document.body.style.width,fa(document.body,u.value)),c=la(y.namespace.value);const l=document.documentElement.clientHeight<document.body.scrollHeight,B=va(document.body,"overflowY");c>0&&(l||B==="scroll")&&n&&(document.body.style.width=`calc(100% - ${c}px)`)}),He(()=>x())},Ta=ze({urlList:{type:ae(Array),default:()=>Pe([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:ae(String)}}),Oa={close:()=>!0,error:i=>i instanceof Event,switch:i=>ye(i),rotate:i=>ye(i)},$a=["src","crossorigin"],Ra=Ne({name:"ElImageViewer",__name:"image-viewer",props:Ta,emits:Oa,setup(i,{expose:_,emit:y}){var u;const c={CONTAIN:{name:"contain",icon:Ce(pa)},ORIGINAL:{name:"original",icon:Ce(ga)}},n=i,v=y;let x;const{t:F}=Te(),l=Ie("image-viewer"),{nextZIndex:B}=De(),C=g(),$=g(),W=Fe(),P=f(()=>{const{scale:e,minScale:t,maxScale:r}=n;return We(e,t,r)}),w=g(!0),M=g(!1),Y=g(!1),h=g(n.initialIndex),j=je(c.CONTAIN),o=g({scale:P.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ue=g((u=n.zIndex)!=null?u:B());Na(Y,{ns:l});const se=f(()=>{const{urlList:e}=n;return e.length<=1}),K=f(()=>h.value===0),te=f(()=>h.value===n.urlList.length-1),q=f(()=>n.urlList[h.value]),ce=f(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!n.infinite&&K.value)]),oe=f(()=>[l.e("btn"),l.e("next"),l.is("disabled",!n.infinite&&te.value)]),ne=f(()=>{const{scale:e,deg:t,offsetX:r,offsetY:L,enableTransition:N}=o.value;let k=r/e,T=L/e;const Z=t*Math.PI/180,H=Math.cos(Z),Q=Math.sin(Z);k=k*H+T*Q,T=T*H-r/e*Q;const ge={transform:`scale(${e}) rotate(${t}deg) translate(${k}px, ${T}px)`,transition:N?"transform .3s":""};return j.value.name===c.CONTAIN.name&&(ge.maxWidth=ge.maxHeight="100%"),ge}),le=f(()=>`${h.value+1} / ${n.urlList.length}`);function X(){fe(),x==null||x(),Y.value=!1,v("close")}function de(){const e=ie(r=>{switch(Ca(r)){case G.esc:n.closeOnPressEscape&&X();break;case G.space:ve();break;case G.left:me();break;case G.up:A("zoomIn");break;case G.right:pe();break;case G.down:A("zoomOut");break}}),t=ie(r=>{const L=r.deltaY||r.deltaX;A(L<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});W.run(()=>{D(document,"keydown",e),D(C,"wheel",t)})}function fe(){W.stop()}function a(){w.value=!1}function S(e){M.value=!0,w.value=!1,v("error",e),e.target.alt=F("el.image.error")}function b(e){if(w.value||e.button!==0||!C.value)return;o.value.enableTransition=!1;const{offsetX:t,offsetY:r}=o.value,L=e.pageX,N=e.pageY,k=ie(H=>{o.value={...o.value,offsetX:t+H.pageX-L,offsetY:r+H.pageY-N}}),T=D(document,"mousemove",k),Z=D(document,"mouseup",()=>{T(),Z()});e.preventDefault()}function U(e){if(w.value||!C.value||e.touches.length!==1)return;o.value.enableTransition=!1;const{offsetX:t,offsetY:r}=o.value,{pageX:L,pageY:N}=e.touches[0],k=ie(H=>{const Q=H.touches[0];o.value={...o.value,offsetX:t+Q.pageX-L,offsetY:r+Q.pageY-N}}),T=D(document,"touchmove",k),Z=D(document,"touchend",()=>{T(),Z()});e.preventDefault()}function Ee(){o.value={scale:P.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ve(){if(w.value||M.value)return;const e=Ge(c),t=Object.values(c),r=j.value.name,N=(t.findIndex(k=>k.name===r)+1)%e.length;j.value=c[e[N]],Ee()}function re(e){M.value=!1;const t=n.urlList.length;h.value=(e+t)%t}function me(){K.value&&!n.infinite||re(h.value-1)}function pe(){te.value&&!n.infinite||re(h.value+1)}function A(e,t={}){if(w.value||M.value)return;const{minScale:r,maxScale:L}=n,{zoomRate:N,rotateDeg:k,enableTransition:T}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...t};switch(e){case"zoomOut":o.value.scale>r&&(o.value.scale=Number.parseFloat((o.value.scale/N).toFixed(3)));break;case"zoomIn":o.value.scale<L&&(o.value.scale=Number.parseFloat((o.value.scale*N).toFixed(3)));break;case"clockwise":o.value.deg+=k,v("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=k,v("rotate",o.value.deg);break}o.value.enableTransition=T}function Ye(e){var t;((t=e.detail)==null?void 0:t.focusReason)==="pointer"&&e.preventDefault()}function Ae(){n.closeOnPressEscape&&X()}function Ve(e){if(!!e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ee(()=>P.value,e=>{o.value.scale=e}),ee(q,()=>{Oe(()=>{const e=$.value;e!=null&&e.complete||(w.value=!0)})}),ee(h,e=>{Ee(),v("switch",e)}),$e(()=>{Y.value=!0,de(),x=D("wheel",Ve,{passive:!1})}),_({setActiveItem:re}),(e,t)=>(E(),be(s(ia),{to:"body",disabled:!e.teleported},{default:p(()=>[d(Ke,{name:"viewer-fade",appear:""},{default:p(()=>[I("div",{ref_key:"wrapper",ref:C,tabindex:-1,class:m(s(l).e("wrapper")),style:Se({zIndex:ue.value})},[d(s(ra),{loop:"",trapped:"","focus-trap-el":C.value,"focus-start-el":"container",onFocusoutPrevented:Ye,onReleaseRequested:Ae},{default:p(()=>[I("div",{class:m(s(l).e("mask")),onClick:t[0]||(t[0]=qe(r=>e.hideOnClickModal&&X(),["self"]))},null,2),z(" CLOSE "),I("span",{class:m([s(l).e("btn"),s(l).e("close")]),onClick:X},[d(s(V),null,{default:p(()=>[d(s(wa))]),_:1})],2),z(" ARROW "),se.value?z("v-if",!0):(E(),R(ke,{key:0},[I("span",{class:m(ce.value),onClick:me},[d(s(V),null,{default:p(()=>[d(s(ha))]),_:1})],2),I("span",{class:m(oe.value),onClick:pe},[d(s(V),null,{default:p(()=>[d(s(ya))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(E(),R("div",{key:1,class:m([s(l).e("btn"),s(l).e("progress")])},[O(e.$slots,"progress",{activeIndex:h.value,total:e.urlList.length},()=>[Ue(Re(le.value),1)])],2)):z("v-if",!0),z(" ACTIONS "),I("div",{class:m([s(l).e("btn"),s(l).e("actions")])},[I("div",{class:m(s(l).e("actions__inner"))},[O(e.$slots,"toolbar",{actions:A,prev:me,next:pe,reset:ve,activeIndex:h.value,setActiveItem:re},()=>[d(s(V),{onClick:t[1]||(t[1]=r=>A("zoomOut"))},{default:p(()=>[d(s(ba))]),_:1}),d(s(V),{onClick:t[2]||(t[2]=r=>A("zoomIn"))},{default:p(()=>[d(s(ka))]),_:1}),I("i",{class:m(s(l).e("actions__divider"))},null,2),d(s(V),{onClick:ve},{default:p(()=>[(E(),be(Ze(j.value.icon)))]),_:1}),I("i",{class:m(s(l).e("actions__divider"))},null,2),d(s(V),{onClick:t[3]||(t[3]=r=>A("anticlockwise"))},{default:p(()=>[d(s(Ia))]),_:1}),d(s(V),{onClick:t[4]||(t[4]=r=>A("clockwise"))},{default:p(()=>[d(s(Ea))]),_:1})])],2)],2),z(" CANVAS "),I("div",{class:m(s(l).e("canvas"))},[M.value&&e.$slots["viewer-error"]?O(e.$slots,"viewer-error",{key:0,activeIndex:h.value,src:q.value}):(E(),R("img",{ref_key:"imgRef",ref:$,key:q.value,src:q.value,style:Se(ne.value),class:m(s(l).e("img")),crossorigin:e.crossorigin,onLoad:a,onError:S,onMousedown:b,onTouchstart:U},null,46,$a))],2),O(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var _a=xe(Ra,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const xa=_e(_a),Pa=ze({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:ae([String,Object])},previewSrcList:{type:ae(Array),default:()=>Pe([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:ae(String)}}),Ya={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>ye(i),close:()=>!0,show:()=>!0},Aa=["src","loading","crossorigin"],Va={key:0},Ba=Ne({name:"ElImage",inheritAttrs:!1,__name:"image",props:Pa,emits:Ya,setup(i,{expose:_,emit:y}){const u=i,c=y,{t:n}=Te(),v=Ie("image"),x=Qe(),F=f(()=>Je(Object.entries(x).filter(([a])=>/^(data-|on[A-Z])/i.test(a)||["id","style"].includes(a)))),l=La({excludeListeners:!0,excludeKeys:f(()=>Object.keys(F.value))}),B=g(),C=g(!1),$=g(!0),W=g(!1),P=g(),w=g(),M=J&&"loading"in HTMLImageElement.prototype;let Y;const h=f(()=>[v.e("inner"),o.value&&v.e("preview"),$.value&&v.is("loading")]),j=f(()=>{const{fit:a}=u;return J&&a?{objectFit:a}:{}}),o=f(()=>{const{previewSrcList:a}=u;return ea(a)&&a.length>0}),ue=f(()=>{const{previewSrcList:a,initialIndex:S}=u;let b=S;return S>a.length-1&&(b=0),b}),se=f(()=>u.loading==="eager"?!1:!M&&u.loading==="lazy"||u.lazy),K=()=>{!J||($.value=!0,C.value=!1,B.value=u.src)};function te(a){$.value=!1,C.value=!1,c("load",a)}function q(a){$.value=!1,C.value=!0,c("error",a)}function ce(a){a&&(K(),le())}const oe=aa(ce,200,!0);async function ne(){var a;if(!J)return;await Oe();const{scrollContainer:S}=u;if(ta(S))w.value=S;else if(oa(S)&&S!=="")w.value=(a=document.querySelector(S))!=null?a:void 0;else if(P.value){const U=ua(P.value);w.value=na(U)?void 0:U}const{stop:b}=Be(P,([U])=>{oe(U.isIntersecting)},{root:w});Y=b}function le(){!J||!oe||(Y==null||Y(),w.value=void 0,Y=void 0)}function X(){!o.value||(W.value=!0,c("show"))}function de(){W.value=!1,c("close")}function fe(a){c("switch",a)}return ee(()=>u.src,()=>{se.value?($.value=!0,C.value=!1,le(),ne()):K()}),$e(()=>{se.value?ne():K()}),_({showPreview:X}),(a,S)=>(E(),R("div",Le({ref_key:"container",ref:P},F.value,{class:[s(v).b(),a.$attrs.class]}),[C.value?O(a.$slots,"error",{key:0},()=>[I("div",{class:m(s(v).e("error"))},Re(s(n)("el.image.error")),3)]):(E(),R(ke,{key:1},[B.value!==void 0?(E(),R("img",Le({key:0},s(l),{src:B.value,loading:a.loading,style:j.value,class:h.value,crossorigin:a.crossorigin,onClick:X,onLoad:te,onError:q}),null,16,Aa)):z("v-if",!0),$.value?(E(),R("div",{key:1,class:m(s(v).e("wrapper"))},[O(a.$slots,"placeholder",{},()=>[I("div",{class:m(s(v).e("placeholder"))},null,2)])],2)):z("v-if",!0)],64)),o.value?(E(),R(ke,{key:2},[W.value?(E(),be(s(xa),{key:0,"z-index":a.zIndex,"initial-index":ue.value,infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,scale:a.scale,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:de,onSwitch:fe},sa({toolbar:p(b=>[O(a.$slots,"toolbar",we(he(b)))]),default:p(()=>[a.$slots.viewer?(E(),R("div",Va,[O(a.$slots,"viewer")])):z("v-if",!0)]),_:2},[a.$slots.progress?{name:"progress",fn:p(b=>[O(a.$slots,"progress",we(he(b)))]),key:"0"}:void 0,a.$slots["viewer-error"]?{name:"viewer-error",fn:p(b=>[O(a.$slots,"viewer-error",we(he(b)))]),key:"1"}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],16))}});var Ma=xe(Ba,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Za=_e(Ma);export{Za as E};
